# SPDX-FileCopyrightText: 2025 Weibo, Inc.
#
# SPDX-License-Identifier: Apache-2.0

# Environment configuration
# Set to "development" for auto migrations, "production" for manual control
ENVIRONMENT=development

# Alembic auto-upgrade configuration
# Enable/disable automatic database migration on startup (only works in development mode)
DB_AUTO_MIGRATE=True

# Database configuration
DATABASE_URL=mysql+pymysql://root:123456@localhost:3306/task_manager

# JWT configuration
SECRET_KEY=your-secret-key-here
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=10080

# EXECUTOR
EXECUTOR_CANCEL_TASK_URL=http://localhost:8001/executor-manager/tasks/cancel
EXECUTOR_DELETE_TASK_URL=http://localhost:8001/executor-manager/executor/delete

# Cache configuration, 2 hour in seconds
REPO_CACHE_EXPIRED_TIME=7200

# Redis configuration
REDIS_URL=redis://127.0.0.1:6379/0

# Celery configuration
# Celery broker and result backend (uses Redis by default)
# CELERY_BROKER_URL=redis://127.0.0.1:6379/0
# CELERY_RESULT_BACKEND=redis://127.0.0.1:6379/0
# If not set, will use REDIS_URL

# Celery Beat scheduler configuration
# RedBeat (default): Uses Redis for distributed schedule storage
# - Automatically handles multi-instance coordination
# - No database migrations needed
# - Simpler and more reliable than SQLAlchemy-based schedulers
# The scheduler uses the same Redis instance as CELERY_BROKER_URL or REDIS_URL

# Task limits
MAX_RUNNING_TASKS_PER_USER=10

# Task append expiration (hours)
APPEND_CHAT_TASK_EXPIRE_HOURS=2
APPEND_CODE_TASK_EXPIRE_HOURS=24

# Subtask executor cleanup configuration
# After a subtask is COMPLETED or FAILED, if executor_name/executor_namespace are set
# and updated_at exceeds this threshold, the executor task will be deleted automatically.
CHAT_TASK_EXECUTOR_DELETE_AFTER_HOURS=2
CODE_TASK_EXECUTOR_DELETE_AFTER_HOURS=24
# Cleanup scanning interval (seconds)
TASK_EXECUTOR_CLEANUP_INTERVAL_SECONDS=600

ENABLE_API_DOCS=True

# Team sharing configuration
TEAM_SHARE_BASE_URL=http://localhost:3000/chat
TASK_SHARE_BASE_URL=http://localhost:3000
TEAM_SHARE_QUERY_PARAM=teamShare

# Group chat history configuration
# In group chat mode, AI-bot sees: first N messages + last M messages (no duplicates)
# If total messages < N + M, all messages are kept
GROUP_CHAT_HISTORY_FIRST_MESSAGES=10
GROUP_CHAT_HISTORY_LAST_MESSAGES=20

# Webhook notification configuration
WEBHOOK_ENABLED=False
# Webhook endpoint
WEBHOOK_ENDPOINT_URL=
# POST、PUT
WEBHOOK_HTTP_METHOD=POST
# brearer、basic、token
WEBHOOK_AUTH_TYPE=
# token
WEBHOOK_AUTH_TOKEN=
# '{"key": "value"}'
WEBHOOK_HEADERS=
# 30
WEBHOOK_TIMEOUT=30

# AES encryption configuration for share tokens and git tokens
# IMPORTANT: These keys are used for encrypting sensitive data including git tokens
# SHARE_TOKEN_AES_KEY must be exactly 32 bytes (32 characters) for AES-256
# SHARE_TOKEN_AES_IV must be exactly 16 bytes (16 characters) for AES IV
# SECURITY WARNING: Change these default values in production!
# Generate secure random keys using: openssl rand -hex 32 (for key) and openssl rand -hex 16 (for IV)
SHARE_TOKEN_AES_KEY=12345678901234567890123456789012
SHARE_TOKEN_AES_IV=1234567890123456

# YAML initialization configuration
# Directory containing YAML files for initial data (default: /app/init_data)
INIT_DATA_DIR=/app/init_data
# Enable/disable YAML initialization on startup (default: True)
INIT_DATA_ENABLED=True


# File upload configuration
# Maximum file size in MB (default: 20)
MAX_UPLOAD_FILE_SIZE_MB=50
# Maximum extracted text length (default: 1000000)
MAX_EXTRACTED_TEXT_LENGTH=1000000

# Attachment encryption configuration
# Enable/disable AES-256-CBC encryption for attachment binary data (default: False)
# When enabled, all newly uploaded attachments will be encrypted
# Existing unencrypted attachments remain accessible (backward compatible)
ATTACHMENT_ENCRYPTION_ENABLED=False
# AES encryption key for attachments (32 bytes for AES-256)
# SECURITY WARNING: Change these default values in production!
# Generate secure random keys using: openssl rand -hex 32 (for key) and openssl rand -hex 16 (for IV)
# These keys are separate from SHARE_TOKEN_AES_KEY for security isolation
ATTACHMENT_AES_KEY=12345678901234567890123456789012
ATTACHMENT_AES_IV=1234567890123456

# Web scraper proxy configuration
# Proxy URL for web scraping (supports HTTP, HTTPS, SOCKS5)
# Examples:
#   - Simple: http://proxy.example.com:8080
#   - With auth: http://user:pass@proxy.example.com:8080
#   - SOCKS5: socks5://proxy.example.com:1080
# Leave empty for direct connection
WEBSCRAPER_PROXY=
# Proxy mode: "direct" or "fallback"
#   - direct: Always use proxy for all requests (proxy must be configured)
#   - fallback: Try direct connection first, use proxy only if direct fails
WEBSCRAPER_PROXY_MODE=fallback

# Web search configuration
# Enable/disable web search feature (default: False)
WEB_SEARCH_ENABLED=False
# Search API configuration as JSON string (adapter for different search engines)
# WEB_SEARCH_ENGINES={"engines":{"google":{"query_param":"q","limit_param":"limit","extra_params":{"format":"json"},"response_path":"results","title_field":"title","url_field":"url","snippet_field":"content"}}}
WEB_SEARCH_ENGINES={}
# Default maximum number of search results when not specified by LLM or engine config (default: 100)
WEB_SEARCH_DEFAULT_MAX_RESULTS=100

# MCP (Model Context Protocol) configuration for Chat Shell
# Enable/disable MCP tools in Chat Shell mode (default: False)
CHAT_MCP_ENABLED=False
# MCP server configurations as JSON string (similar to Claude Desktop format)
# Supported server types: stdio, sse, streamable-http
# Example configurations:
# - SSE server: {"mcpServers":{"image-gen":{"type":"sse","url":"http://localhost:8080/sse","headers":{"Authorization":"Bearer xxx"}}}}
# - stdio server: {"mcpServers":{"ppt-gen":{"type":"stdio","command":"npx","args":["-y","@example/ppt-mcp-server"],"env":{"API_KEY":"xxx"}}}}
# - Multiple servers: {"mcpServers":{"server1":{"type":"sse","url":"http://localhost:8080/sse"},"server2":{"type":"stdio","command":"npx","args":["-y","@example/mcp-server"]}}}
# See backend/app/services/chat/mcp_client/README.md for detailed documentation
CHAT_MCP_SERVERS={}

# Tool calling flow limits for Chat Shell
# Maximum LLM requests in tool calling flow (default: 5)
CHAT_TOOL_MAX_REQUESTS=5
# Maximum time for tool calling flow in seconds (default: 30.0)
CHAT_TOOL_MAX_TIME_SECONDS=30.0
# Maximum time to wait for active streaming requests to complete (seconds)
# Default: 600 seconds (10 minutes) to allow long-running streaming requests to complete
GRACEFUL_SHUTDOWN_TIMEOUT=600
# Whether to reject new requests during shutdown (503 Service Unavailable)
# Set to False if you want to allow requests during shutdown (not recommended)
SHUTDOWN_REJECT_NEW_REQUESTS=True

# Wiki feature configuration (System-level)
# Wiki tables are now stored in the main database (task_manager)
# Wiki generation is system-level: team and model are configured here, not selected by users
# Feature toggle
WIKI_ENABLED=True
# Default team name for wiki task execution (matches init_data/01-default-resources.yaml)
# The team's bot MUST have a model configured (bind_model or custom config)
# If no model is configured, wiki generation will be disabled in the frontend
WIKI_DEFAULT_TEAM_NAME=wiki-team
# Default agent type for wiki generation
WIKI_DEFAULT_AGENT_TYPE=ClaudeCode
# Default language for wiki documentation generation (en = English, zh = Chinese)
# This is a system-level configuration, users cannot change it in the frontend
WIKI_DEFAULT_LANGUAGE=en
# User ID for wiki task creation (0 = use current user ID, set to specific user ID for system-level tasks)
# When set to a specific user ID, all wiki tasks will be created under that user
WIKI_DEFAULT_USER_ID=1
# Maximum concurrent wiki generations
WIKI_MAX_CONCURRENT_GENERATIONS=5
# Background polling interval (seconds)
WIKI_RESULT_POLL_INTERVAL_SECONDS=30
# Background polling batch size
WIKI_RESULT_POLL_BATCH_SIZE=20
# Maximum content size (bytes, default 10MB)
WIKI_MAX_CONTENT_SIZE=10485760
# Base URL for internal wiki content writer
WIKI_CONTENT_WRITE_BASE_URL=http://backend:8000

# Data Table Configuration
# JSON string containing table provider credentials (DingTalk, etc.)
# Format: {"dingtalk":{"appKey":"YOUR_APP_KEY","appSecret":"YOUR_APP_secret","operatorId":"YOUR_OPERATOR_ID","userMapping":{"baseId":"YOUR_BASE_ID","sheetId":"YOUR_SHEET_ID"}}}
# See backend/app/services/tables/DATA_TABLE_CONFIG_EXAMPLE.md for detailed configuration guide
DATA_TABLE_CONFIG={"dingtalk":{"appKey":"YOUR_APP_KEY","appSecret":"YOUR_APP_secret","operatorId":"YOUR_OPERATOR_ID","userMapping":{"baseId":"YOUR_BASE_ID","sheetId":"YOUR_SHEET_ID"}}}

# Default team configuration for each mode
DEFAULT_TEAM_CHAT=wegent-chat#default
DEFAULT_TEAM_KNOWLEDGE=wegent-notebook#default

# Long-term memory configuration (mem0)
# Optional API key for mem0 service authentication
MEMORY_API_KEY=
# mem0 service base URL (default: http://localhost:8080)
MEMORY_BASE_URL=http://localhost:8080
# Enable/disable long-term memory feature (default: False)
MEMORY_ENABLED=False
# Maximum number of memories to inject into system prompt (default: 5)
MEMORY_MAX_RESULTS=5
# Search timeout in seconds (default: 2.0) - to avoid blocking chat flow
MEMORY_TIMEOUT_SECONDS=2.0
# Number of recent messages to include as context when saving memory (default: 3)
# This includes 2 history messages + 1 current message for better memory quality
MEMORY_CONTEXT_MESSAGES=3
